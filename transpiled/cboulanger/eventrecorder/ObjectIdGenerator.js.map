{
  "version": 3,
  "sources": [
    "/home/travis/build/cboulanger/eventrecorder/source/class/cboulanger/eventrecorder/ObjectIdGenerator.js"
  ],
  "names": [
    "qx",
    "Bootstrap",
    "executePendingDefers",
    "$$dbClassInfo",
    "Class",
    "define",
    "type",
    "extend",
    "core",
    "Object",
    "include",
    "cboulanger",
    "eventrecorder",
    "MHelperMethods",
    "events",
    "members",
    "init",
    "event",
    "Timer",
    "once",
    "assignObjectIdsToChildren",
    "Init",
    "getApplication",
    "getRoot",
    "fireEvent",
    "addGlobalEventListener",
    "target",
    "getType",
    "generateId",
    "qxObj",
    "clazz",
    "classname",
    "substr",
    "lastIndexOf",
    "generateQxObjectId",
    "obj",
    "owner",
    "id",
    "getQxObjectId",
    "setQxObjectId",
    "siblingWithSameName",
    "postfix",
    "addOwnedQxObject",
    "e",
    "Id",
    "getInstance",
    "register",
    "parent",
    "level",
    "children",
    "getChildren",
    "getLayoutChildren",
    "length",
    "child",
    "ui",
    "popup",
    "Popup",
    "realChild",
    "getChildControl",
    "getSelection",
    "getMenu",
    "addListener",
    "getSelectionModel",
    "_manager",
    "defer",
    "bom",
    "Lifecycle",
    "onReady",
    "ObjectIdGenerator"
  ],
  "mappings": "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",
  "file": "ObjectIdGenerator.js",
  "sourcesContent": [
    "/**\n * When added to the `applications[x].include` section of `compile.json`,\n * this class will automatically assign ids to all the widgets in the\n * widget hierarchy, i.e. all objects that are added as child object via\n * the `add()` method provided my `qx.ui.core.MChildrenHandling`. The id\n * generator assigns ids to all widgets that do not already have an id\n * using the last part of the class namespace plus the integer hash code of\n * the widget. This will result in absolute ids of the form\n * `Composite50/Scroll117/TabView120/TabPage147`\n */\nqx.Class.define(\"cboulanger.eventrecorder.ObjectIdGenerator\", {\n  type: \"singleton\",\n  extend: qx.core.Object,\n  include : [cboulanger.eventrecorder.MHelperMethods],\n  events: {\n    \"done\" : \"qx.event.type.Event\"\n  },\n  members: {\n\n    /**\n     * Start automatically assigning ids.\n     */\n    init: function() {\n      // start generating ids with a delay because rendering widgets is asynchrous\n      qx.event.Timer.once(() => {\n        this.assignObjectIdsToChildren(qx.core.Init.getApplication().getRoot());\n        this.fireEvent(\"done\");\n      }, null, 2000);\n      this.addGlobalEventListener((target, event) => {\n        if (event.getType() === \"appear\") {\n          this.assignObjectIdsToChildren(qx.core.Init.getApplication().getRoot());\n        }\n      });\n    },\n\n    /**\n     * Given a {@link qx.core.Object}, return an id for it, which is the last\n     * part of the class name\n     * @param qxObj {qx.core.Object}\n     * @return {String}\n     */\n    generateId: function(qxObj) {\n      let clazz = qxObj.classname;\n      return clazz.substr(clazz.lastIndexOf(\".\")+1);\n    },\n\n    /**\n     * Given an object and its parent, set its object id and add it to the\n     * parent's owned objects. If the object doesn't have a parent or the\n     * parent has no object id, register the object as a global id root.\n     * @param obj The object to assign an object id to\n     * @param owner The owning parent object\n     * @param id {String|undefined} Optional id. If not given, generate an id from\n     * the class name\n     */\n    generateQxObjectId: function(obj, owner, id) {\n      if (!obj || typeof obj.getQxObjectId != \"function\" || obj.getQxObjectId()) {\n        return;\n      }\n      id = id || this.generateId(obj);\n      obj.setQxObjectId(id);\n      if (owner && owner.getQxObjectId()) {\n        // if the parent has an id, we add the child as an owned object\n        let siblingWithSameName = false;\n        let postfix = 1;\n        do {\n          try {\n            owner.addOwnedQxObject(obj);\n            siblingWithSameName=false;\n            // console.log(`Adding ${obj} to ${parent} with id '${id}'`);\n          } catch (e) {\n            // name already exists, append a number\n            siblingWithSameName = true;\n            postfix++;\n            obj.setQxObjectId(id+postfix);\n          }\n        } while (siblingWithSameName);\n      } else {\n        // otherwise, we register it as a top-level object\n        //console.log(`Registering ${obj} as global id root with id '${id}'`);\n        qx.core.Id.getInstance().register(obj, id);\n      }\n    },\n\n    /**\n     * Recursively assigns object ids to the children of the given parent widget.\n     * @param parent {qx.ui.core.Widget|qx.ui.core.MChildrenHandling} An object that must include\n     * the qx.ui.core.MChildrenHandling mixin.\n     * @param level {Number}\n     */\n    assignObjectIdsToChildren: function(parent, level=0) {\n      if (!parent) {\n        return;\n      }\n      let children =\n        typeof parent.getChildren == \"function\" ?\n          parent.getChildren() :\n          typeof parent.getLayoutChildren == \"function\" ?\n            parent.getLayoutChildren() : null;\n      // let msg = \"    \".repeat(level) + parent.classname;\n      // if ( !children || ! children.length) {\n      //   console.log(msg + \" (no children)\");\n      //   return;\n      // }\n      // console.log(msg);\n      if (!children || !children.length) {\n        return;\n      }\n      for (let child of children) {\n       // ignore popups\n       if (child instanceof qx.ui.popup.Popup) {\n         continue;\n       }\n        // assign object id and add to parent if neccessary\n        this.generateQxObjectId(child, parent);\n        // recurse into children\n        let realChild = child;\n        let id;\n        switch (child.classname) {\n          case \"qx.ui.form.ComboBox\":\n            realChild = child.getChildControl(\"textfield\");\n            break;\n          case \"qx.ui.form.VirtualSelectBox\":\n            realChild = child.getSelection();\n            break;\n          case \"qx.ui.groupbox.GroupBox\":\n            realChild = child.getChildControl(\"frame\");\n            break;\n          case \"qx.ui.form.MenuButton\":\n          case \"qx.ui.toolbar.MenuButton\":\n          case \"qx.ui.menubar.Button\":\n            realChild = child.getMenu();\n            break;\n          case \"qx.ui.treevirtual.TreeVirtual\":\n            child.addListener(\"treeClose\", () => {});\n            child.addListener(\"treeOpenWithContent\", () => {});\n            child.addListener(\"treeOpenWhileEmpty\", () => {});\n            // fallthrough\n          case \"qx.ui.table.Table\":\n            realChild = child.getSelectionModel();\n            id = \"Selection\";\n            break;\n          case \"qx.ui.list.List\":\n            realChild = child.getSelection();\n            id = \"Selection\";\n            break;\n          case \"qx.ui.tabview.Page\":\n            this.generateQxObjectId(child.getChildControl(\"button\"), child);\n            break;\n          case \"qx.ui.tree.VirtualTree\":\n            child.addListener(\"open\", () => {});\n            child.addListener(\"close\", () => {});\n            this.generateQxObjectId(child._manager, child);\n            continue;\n        }\n        if (realChild !== child) {\n          this.generateQxObjectId(realChild, child, id);\n        }\n        this.assignObjectIdsToChildren(realChild, level+1);\n      }\n    }\n  },\n\n  /**\n  * Will be called after class has been loaded, before application startup\n  */\n  defer: function() {\n    if (qx.core.Environment.get(\"module.objectid\")) {\n      qx.bom.Lifecycle.onReady(() => cboulanger.eventrecorder.ObjectIdGenerator.getInstance().init());\n    }\n  }\n});\n"
  ]
}